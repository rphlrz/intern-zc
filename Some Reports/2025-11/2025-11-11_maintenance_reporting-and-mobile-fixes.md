## Code-Behind Normalization, Dynamic Report Selection, and GUID/ID Standardization

I normalized and adapted the code-behind that had been copied from a generic report. The main changes were: correct session parameter handling and replace equipment-focused queries with location-focused queries. The report expected a GUID-based key (QrIdentifier), while some parts of the system still passed integer IDs; this caused type mismatch exceptions. I refactored data access to minimize database round-trips: one isolated query to fetch the company logo (requires a separate database context) and one main JOIN that aggregates Location, Company and Layout parameters via a JOIN with the configuration table. I also resolved namespace conflicts in the dataset class and ensured SQL connections are closed with try/finally to avoid resource leaks.

To make the report selection dynamic, I implemented runtime loading of the .rpt file name: the system now chooses between two layout files based on a configuration string returned by the database instead of using hardcoded conditionals. I aligned the dataset schema expected by the report by aliasing a location code column to LocationCode and removed obsolete fields and parameters that the new report no longer uses. For QR code generation I standardized the format to 3#GUID, obtaining the QrIdentifier directly from the query result and ensured the repository layer returns GUIDs correctly for the UI.